{% load static %}
{% load i18n %}
{% load rest_framework %}


<!DOCTYPE html>
<html lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="robots" content="NONE,NOARCHIVE" />

      <title>{% block title %}{% if name %}{{ name }} – {% endif %}接口自动化测试平台{% endblock %}</title>
          <link rel="stylesheet" type="text/css" href="{% static "rest_framework/css/bootstrap.min.css" %}"/>
          <link rel="stylesheet" type="text/css" href="{% static "rest_framework/css/bootstrap-tweaks.css" %}"/>
<link rel="stylesheet" type="text/css" href="{% static "rest_framework/css/bootstrap-tweaks.css" %}"/>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
        <link rel="stylesheet" type="text/css" href="{% static "rest_framework/css/prettify.css" %}"/>
        <link rel="stylesheet" type="text/css" href="{% static "rest_framework/css/default.css" %}"/>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript"
            charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ext-language_tools.js" type="text/javascript"
            charset="utf-8"></script>
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="{% static 'assets/js/commons.js' %}"></script>
    <script src="{% static "rest_framework/js/jquery-3.5.1.min.js" %}"></script>
      <script src="{% static "rest_framework/js/ajax-form.js" %}"></script>
      <script src="{% static "rest_framework/js/csrf.js" %}"></script>
      <script src="{% static "rest_framework/js/bootstrap.min.js" %}"></script>
      <script src="{% static "rest_framework/js/prettify-min.js" %}"></script>
      <script src="{% static "rest_framework/js/default.js" %}"></script>
</head>
<body>
<div class="content-main" role="main"  aria-label="{% trans "main content" %}">
<div class="submit-row"><button type="button" onclick="prev()" class="el-button el-button--button el-button--small" style="float: left; margin-right: 10px; margin-bottom: 10px;"><i class="el-icon-arrow-left"></i><span><span>返回</span></span></button></div>
              <div class="page-header">
                <h1>请求数据</h1>

              </div>



<div class="request-info" style="clear: both" aria-label="{% trans "request info" %}">

<pre id="req" class="ace_editor" style="margin-top: 0px; margin-bottom: 0px">
<textarea>
    {{ jsondata|urlize }}
</textarea>
</pre>

   <button id='request' class="btn btn-primary js-tooltip">发送请求</button>
              </div>



              <div class="page-header">
                 <h1>响应数据</h1>
              </div>


              <div class="response-info" aria-label="{% trans "response info" %}">
<pre id="res" class="ace_editor" style="margin-top: 0px; margin-bottom: 0px">
<textarea>
{{ respdata|urlize }}
</textarea>
</pre>


<button class="btn btn-primary js-tooltip" data-toggle="modal" data-target="#myModal">生成新用例</button>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					填写参数
				</h4>
			</div>
			<form action="{% url 'api-detail' id%}gennewcase/" method="POST" enctype="multipart/form-data" novalidate>
				{% csrf_token %}
			<div class="modal-body form">
<div class="row" style="white-space: nowrap; margin-top: 20px;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">测试用例名称</label></span>
				<span class="col-xs-8"><input name="casename" class="form-control" value="请输入测试用例名称">
				<span>
				</div>

<div class="row" style="white-space: nowrap; margin-top: 20px;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">分组</label></span>
				<span class="col-xs-8">
					<select name="group" class="form-control">
						<option value="">-</option>
				{% for data in testgroup%}
					<option value={{data.id}}>{{data}}</option>
				{% endfor %}
				</select>
				<span>
				</div>

<div class="row" style="white-space: nowrap; margin-top: 20px;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">环境地址</label></span>
				<span class="col-xs-8">
					<select name="baseurl" class="form-control">
						<option value="">-</option>
				{% for data in baseurl%}
					<option value={{data.id}}>{{data}}</option>
				{% endfor %}
				</select>
				<span>
				</div>

<div class="row" style="white-space: nowrap; margin-top: 20px;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">前置方法</label></span>
				<span class="col-xs-8">
					<select name="setupfunc" class="form-control">
						<option value="">-</option>
				{% for data in setupfunc%}
					<option value={{data.id}}>{{data}}</option>
				{% endfor %}
				</select>
				<span>
				</div>

<div class="row" style="white-space: nowrap; margin-top: 20px;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">后置方法</label></span>
				<span class="col-xs-8">
					<select name="teardownfunc" class="form-control">
						<option value="">-</option>
				{% for data in teardownfunc%}
					<option value={{data.id}}>{{data}}</option>
				{% endfor %}
				</select>
				<span>
				</div>

<div class="row" style="white-space: nowrap; margin-top: 20px;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">自定义运行方法</label></span>
				<span class="col-xs-8">
					<select name="callfunc" class="form-control">
						<option value="">-</option>
				{% for data in callfunc%}
					<option value={{data.id}}>{{data}}</option>
				{% endfor %}
				</select>
				<span>
				</div>

<div class="row" style="white-space: nowrap; margin-top: 20px;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">是否有效</label></span>
				<span class="col-xs-8">
					<select name="isValid" class="form-control">
						<option value=True>是</option>
						<option value=False>否</option>
				</select>
				<span>
				</div>

<div class="row" style="white-space: nowrap; margin-top: 20px;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">自动生成校验数据</label></span>
				<span class="col-xs-8">
					<select name="assertion" class="form-control">
						<option value=True>是</option>
						<option value=False>否</option>
				</select>
				<span>
				</div>

<div class="row" style="white-space: nowrap; margin-top: 20px;display: none;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">请求数据</label></span>
				<span class="col-xs-8">
					<textarea class="form-control" name="jsondata" rows="" cols="">
						{{ jsondata }}
					</textarea>
				<span>
				</div>

<div class="row" style="white-space: nowrap; margin-top: 20px;display: none;"><span class="col-xs-4"><label style="text-align: center;width: 100%;">响应数据</label></span>
				<span class="col-xs-8">
					<textarea class="form-control" name="respdata" rows="" cols="">
						{{ respdata }}
					</textarea>
				<span>
				</div>

			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>
				<button type="submit" class="btn btn-primary">
					提交
				</button>
			</div>
			</form>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>
              </div>
            </div>



<script>
    function prev() {
             window.location.href='/admin/apitest/api/'
        }

    //初始化对象
    editor1 = ace.edit("req");
    editor2 = ace.edit("res");
    init_acs('json', 'monokai', editor1);
    init_acs('json', 'monokai', editor2);
    $(function () {
        var height = (window.screen.height - 500) + 'px';
        $('#req').css('min-height', height);
        $('#res').css('min-height', height);
    });

    function post(url, params) {
        var temp = document.createElement("form");
        temp.action = url;
        temp.method = "post";
        temp.style.display = "none";
        for (var x in params) {
            var opt = document.createElement("input");
            opt.name = x;
            opt.value = params[x];
            temp.appendChild(opt);
        }
        document.body.appendChild(temp);
        temp.submit();
        return temp;
    }

    $('#request').click(function () {
        reqdata = editor1.session.getValue();
        post('/api/{{ id }}/runapi/', {'reqdata': reqdata});
    });

    $('#newcase').click(function () {
        reqcont = editor1.session.getValue();
        rescont = editor2.session.getValue();
        post('/testcase/{{ id }}/gennewcase/', {'reqcont': reqcont,'rescont': rescont});
    });

</script>

</body>
</html>