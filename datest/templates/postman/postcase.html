{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify simpletags%}
{% load static %}
{% load rest_framework %}
{% block extrahead %}{{ block.super }}
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>
<script src="//unpkg.com/vue/dist/vue.js"></script>
<script src="//unpkg.com/element-ui@2.15.1/lib/index.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript"
            charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ext-language_tools.js" type="text/javascript"
            charset="utf-8"></script>
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="{% static 'assets/js/commons.js' %}"></script>
<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
    <script src="{% static "rest_framework/js/jquery-3.5.1.min.js" %}"></script>
      <script src="{% static "rest_framework/js/ajax-form.js" %}"></script>
      <script src="{% static "rest_framework/js/csrf.js" %}"></script>
      <script src="{% static "rest_framework/js/bootstrap.min.js" %}"></script>
      <script src="{% static "rest_framework/js/prettify-min.js" %}"></script>
      <script src="{% static "rest_framework/js/default.js" %}"></script>
{{ media }}

{% endblock %}
{% block extrastyle %}{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static '/admin/css/forms.css' %}"/>
<link rel="stylesheet" type="text/css" href="//unpkg.com/element-ui@2.15.1/lib/theme-chalk/index.css"/>

{% endblock %}
{% block content %}
<style type="text/css">
    .inline-group .tabular td.original p {
        margin-top: -50px;
        height: 1.2em;
    }

    .page-header {
        padding: 10px;
    }

</style>
<div id="content-main" class="form-main">
    <div class="page-header">
        <el-page-header @back="goBack" content="{{title}}"/>
    </div>
	<div id="app" v-loading="loading">
<div class="submit-row">
	<button type="button" onclick="prev()" class="el-button el-button--button el-button--small" style="float: left; margin-right: 10px; margin-bottom: 10px;"><i class="el-icon-arrow-left"></i><span><span>返回</span></span></button>

     <el-button class="el-button el-button--danger el-button--small" @click="addautoassert()">提交</el-button>

</div>

			            {% if errors %}
            <div id="alert">
                <el-alert
                        title="{% if errors|length == 1 %}
                            {% trans 'Please correct the error below.' %}
                {% else %}
                {% trans 'Please correct the errors below.' %}
                {% endif %}"
                type="error">
                </el-alert>
            </div>
            {{ adminform.form.non_field_errors }}
            {% endif %}

         <el-row>
        <el-col>
      	  <el-card class="box-card">
  <div slot="header" class="clearfix">
    <span>自动生成断言</span>
    <el-button style="float: right;" class="el-button el-button--primary el-button--small" @click="openmodel()">自动生成</el-button>
  </div>
              <el-form :model="adForm" ref="adForm" class="demo-dynamic">
                   <el-row>
    <el-col :span="8">
        <span>参数</span>
    </el-col>
    <el-col :span="8">
        <span>值</span>
    </el-col>
    <el-col :span="6">
        <span>模式</span>
    </el-col>
        <el-col :span="2">
        <span>操作</span>
    </el-col>
</el-row>
        <el-form-item
v-for="(adata,index) in adForm.assertdatalist"
    :key="adata.key"
    :prop="'assertdatalist.' + index"
        >

             <el-row>
             <el-col :span="4">
        <el-input v-model="adata.path" placeholder="请输入内容"></el-input>
    </el-col>
           <el-col :span="14">
        <el-input type="textarea" autosize v-model="adata.value" placeholder="请输入内容"></el-input>
    </el-col>
          <el-col :span="4">
              <el-select v-model="adata.mode" placeholder="请选择">
              <el-option
      v-for="item in modes"
      :key="item.value"
      :label="item.label"
      :value="item.value">
    </el-option>
                  </el-select>
    </el-col>
          <el-col :span="2">
                      <el-button @click.prevent="removedata(adata)" size="mini" type="danger" icon="el-icon-delete" circle></el-button>
    </el-col>
      </el-row>
            </el-form-item>
        <el-form-item>
                <el-button @click.prevent="adddata()" size="mini" type="success" icon="el-icon-circle-plus-outline" circle></el-button>
        </el-form-item>
    </el-form>


</el-card>

  </el-col>
</el-row>

<el-row>
        <el-col>
      	  <el-card class="box-card">
  <div slot="header" class="clearfix">
    <span>请求</span>
  </div>
<el-form><el-form-item>
              <el-input
  type="textarea"
  name="reqdata"
  :rows="3"
  v-model="reqdata">
</el-input>
          </el-form-item></el-form>
</el-input>
</el-card>

  </el-col>
</el-row>
        <el-row>
        <el-col>
      	  <el-card class="box-card">
  <div slot="header" class="clearfix">
    <span>响应</span>
  </div>
              <el-form><el-form-item>

              <el-input
  type="textarea"
  autosize
  name="respdata"
  :rows="10"
  v-model="respdata">
</el-input>
          </el-form-item></el-form>

</el-card>

  </el-col>
</el-row>






<!--<el-dialog title="自动生成校验" :visible.sync="dialogFormVisible">-->


<!--                      <el-input-->
<!--  name="assertdata"-->
<!--  type="textarea"-->
<!--  :rows="10"-->
<!--  v-model="assertdata">-->
<!--</el-input>-->
<!--  <div slot="footer" class="dialog-footer">-->
<!--    <el-button @click="dialogFormVisible = false">取 消</el-button>-->
<!--    <el-button  type="primary" @click="addautoassert()">确 定</el-button>-->
<!--  </div>-->

<!--</el-dialog>-->

</div>











        </div>

</div>
<script type="text/javascript">

    new Vue({
        el: '.page-header',
        methods: {
            goBack: function () {
                window.location.href = '{% get_previous_url %}'
            }
        }
    })

    function prev() {
             window.location.href='/admin/apitest/testcase/'
        }




	var vm = new Vue({
  el: '#app',
  data () {
    return {
      loading: true,
      reqdata: '',
      respdata: '',
      assertdata: '',
      dialogTableVisible: false,
      dialogFormVisible: false,
      formLabelWidth: '120px',
      adForm: {
        assertdatalist: []
      },
      modes: [{
          value: 'assert_equal',
          label: '完全匹配'
        },
        {
          value: 'assert_contains',
          label: '包含'
        },{
          value: 'assert_regex_match',
          label: '正则匹配'
        },{
          value: 'assert_json_contains',
          label: 'json完全匹配'
        },{
          value: 'assert_jsonmatch',
          label: 'json正则匹配'
        }]
    }
  },

mounted() {
  this.assertdata = '{{ assertdata|escapejs }}';
  this.reqdata = '{{ jsondata|escapejs }}';
  this.respdata = '{{ respdata|escapejs }}';
  this.loading = false;
},
   methods:{
            removedata:function (item) {
            var index = this.adForm.assertdatalist.indexOf(item);
            if (index !== -1) {
            this.adForm.assertdatalist.splice(index, 1)
        };
            },
            adddata() {
        this.adForm.assertdatalist.push({"no":'', "path": '', "value": '', "mode": 'assert_equal'});
      },
	        openmodel:function () {
        	            //发送 post 请求
	            this.$http.post('/testcase/{{ id }}/getassertdata/',{'respdata': this.respdata},{emulateJSON:true}).then(function(res){
                    this.adForm.assertdatalist=res.body;
                },function(res){
                    console.log(res.status);
                });
<!--                this.dialogFormVisible = true;-->
    },
	        addautoassert:function () {
        post('/testcase/{{ id }}/genassertdata/', {'assertdata': JSON.stringify(this.adForm.assertdatalist)});
        dialogFormVisible = false;
    }
	    }
});

</script>
{% endblock %}
