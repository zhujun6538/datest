{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify simpletags%}
{% load static %}
{% load rest_framework %}
{% block extrahead %}{{ block.super }}
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>
<script src="//unpkg.com/vue/dist/vue.js"></script>
<script src="//unpkg.com/element-ui@2.15.1/lib/index.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript"
            charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ext-language_tools.js" type="text/javascript"
            charset="utf-8"></script>
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="{% static 'assets/js/commons.js' %}"></script>
<script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
<script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
    <script src="{% static "rest_framework/js/jquery-3.5.1.min.js" %}"></script>
      <script src="{% static "rest_framework/js/ajax-form.js" %}"></script>
      <script src="{% static "rest_framework/js/csrf.js" %}"></script>
      <script src="{% static "rest_framework/js/bootstrap.min.js" %}"></script>
      <script src="{% static "rest_framework/js/prettify-min.js" %}"></script>
      <script src="{% static "rest_framework/js/default.js" %}"></script>
{{ media }}

{% endblock %}
{% block extrastyle %}{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static '/admin/css/forms.css' %}"/>
<link rel="stylesheet" type="text/css" href="//unpkg.com/element-ui@2.15.1/lib/theme-chalk/index.css"/>

{% endblock %}
{% block content %}
<style type="text/css">
    .inline-group .tabular td.original p {
        margin-top: -50px;
        height: 1.2em;
    }

    .page-header {
        padding: 10px;
    }

</style>
<div id="content-main" class="form-main">
    <div class="page-header">
        <el-page-header @back="goBack" content="{{title}}"/>
    </div>
<div id="app">
<div class="submit-row">

	<button @click="openmodel()" class="el-button el-button--primary el-button--small">
        生成新用例
        </button>
</div>

			            {% if errors %}
            <div id="alert">
                <el-alert
                        title="{% if errors|length == 1 %}
                            {% trans 'Please correct the error below.' %}
                {% else %}
                {% trans 'Please correct the errors below.' %}
                {% endif %}"
                type="error">
                </el-alert>
            </div>
            {{ adminform.form.non_field_errors }}
            {% endif %}

	<el-row>
  <el-col>

      <el-card class="box-card">
  <div slot="header" class="clearfix">
    <span>请求</span>
    <button @click="post()" style="float: right;" class="el-button el-button--danger el-button--small">发送</button>
  </div>
<el-input
  type="textarea"
  :rows="2"
  placeholder="请输入内容"
  v-model="reqdata">
</el-input>
</el-card>
<!--	  <pre id="req" class="ace_editor" style="margin-top: 0px; margin-bottom: 0px">-->
<!--<textarea>-->
<!--    {{ jsondata }}-->
<!--</textarea>-->
<!--</pre>-->
  </el-col>
</el-row>

        <el-row>
        <el-col>
      	  <el-card class="box-card">
  <div slot="header" class="clearfix">
    <span>响应</span>
  </div>
              <el-input
  type="textarea"
  autosize
  name="respdata"
  :rows="10"
  v-model="respdata">
</el-input>

</el-card>

  </el-col>
</el-row>

<el-dialog title="新增用例" :visible.sync="dialogFormVisible">
  <el-form :model="caseform" action="{% url 'api-detail' id%}gennewcase/" method="POST" enctype="multipart/form-data" novalidate>
    {% csrf_token %}
      <el-form-item label="测试用例名称" :label-width="formLabelWidth">
      <el-input name="casename" v-model="caseform.name" autocomplete="off"></el-input>
    </el-form-item>
    <el-form-item label="分组" :label-width="formLabelWidth">
      <el-select name="group"  v-model="caseform.testgroup" clearable placeholder="请选择">
          {% for data in testgroup%}
          <el-option value="{{data.id}}-{{data}}">{{data}}</el-option>
				{% endfor %}
      </el-select>
        </el-form-item>
<!--        <el-form-item label="环境地址" :label-width="formLabelWidth">-->
<!--              <el-select name="baseurl" v-model="caseform.baseurl" clearable placeholder="请选择">-->
<!--          {% for data in baseurl%}-->
<!--          <el-option value="{{data.id}}-{{data}}">{{data}}</el-option>-->
<!--				{% endfor %}-->
<!--      </el-select>-->
<!--            </el-form-item>-->
<!--            <el-form-item label="前置方法" :label-width="formLabelWidth">-->
<!--                      <el-select name="setupfunc" v-model="caseform.setupfunc" clearable placeholder="请选择">-->
<!--          {% for data in setupfunc%}-->
<!--          <el-option value="{{data.id}}-{{data}}">{{data}}</el-option>-->
<!--				{% endfor %}-->
<!--      </el-select>-->
<!--                </el-form-item>-->
<!--                <el-form-item label="后置方法" :label-width="formLabelWidth">-->
<!--                      <el-select name="teardownfunc" v-model="caseform.teardownfunc" clearable placeholder="请选择">-->
<!--          {% for data in teardownfunc%}-->
<!--          <el-option value="{{data.id}}-{{data}}">{{data}}</el-option>-->
<!--				{% endfor %}-->
<!--      </el-select>-->
<!--                    </el-form-item>-->
<!--                    <el-form-item label="自定义运行方法" :label-width="formLabelWidth">-->
<!--                      <el-select name="callfunc" v-model="caseform.callfunc" clearable placeholder="请选择">-->
<!--          {% for data in callfunc%}-->
<!--          <el-option value="{{data.id}}-{{data}}">{{data}}</el-option>-->
<!--				{% endfor %}-->
<!--      </el-select>-->
<!--                        </el-form-item>-->
               <el-form-item label="请求参数" :label-width="formLabelWidth">
        <el-input
  type="textarea"
  name="jsondata"
  :rows="3"
  placeholder="请输入内容"
  v-model="caseform.requestdata">
</el-input>
    </el-form-item>
<!--                     <el-form-item label="响应参数" :label-width="formLabelWidth">-->
<!--        <el-input-->
<!--  type="textarea"-->
<!--  name="responsedata"-->
<!--  :rows="3"-->
<!--  placeholder="请输入内容"-->
<!--  v-model="caseform.responsedata">-->
<!--</el-input>-->
<!--    </el-form-item>-->

<!--  <div slot="footer" class="dialog-footer">-->
    <el-button @click="dialogFormVisible = false">取 消</el-button>
    <el-button native-type="submit" type="primary" @click="dialogFormVisible = false">确 定</el-button>
<!--  </div>-->
      </el-form-item>
  </el-form>
</el-dialog>
</div>
</div>

<script type="text/javascript">

    new Vue({
        el: '.page-header',
        methods: {
            goBack: function () {
                window.location.href = '{% get_previous_url %}'
            }
        }
    })

    function prev() {
             window.location.href='/admin/apitest/api/'
        }

	var vm = new Vue({
  el: '#app',
  data () {
    return {
      reqdata: '',
      respdata: '',
      dialogFormVisible: false,
      formLabelWidth: '120px',
      caseform: {
          name: '',
          testgroup: '',
          baseurl: '',
          setupfunc: '',
          teardownfunc: '',
          callfunc: '',
          isvalid: true,
          requestdata: '',
          responsedata: ''
        }
    }
  },
   methods:{
	        post:function(){
	            //发送 post 请求
	            this.$http.post('/api/{{ id }}/postapi/',{'reqdata': this.reqdata},{emulateJSON:true}).then(function(res){
                    this.respdata=res.body;
                },function(res){
                    console.log(res.status);
                });
	        },
	        openmodel:function () {
        this.caseform.requestdata = this.reqdata;
        this.caseform.responsedata = this.respdata;
        this.dialogFormVisible = true;
    },
	        createobj:function () {
        reqcont = this.reqdata;
        rescont = this.respdata;
        post('/testcase/{{ id }}/gennewcase/', {'reqcont': reqcont,'rescont': rescont});
    }
	    }
});
</script>
{% endblock %}
