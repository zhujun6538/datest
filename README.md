# datest接口自动化测试平台v1.0

## 演示地址：http://121.36.246.73:7777 登录名:guest 密码:guest111111

## 安装说明: 
0. 安装jdk1.8及allure-commandline-2.13.0
1. git clone https://gitee.com/zhujun6538/datest.git或者下载压缩包
2. 安装ENV虚拟环境
3. 使用虚拟环境在根目录输入:pip install -r requirements
4. 将datest/settings.py的数据库地址改为自己的数据库地址
5. 根目录运行python manage.py makemigrations apitest，python manage.py migrate，python manage.py createsuperuser
6. 根目录运行python manage.py runserver启动程序


## 简介：
本平台充分将多个模块进行整合，构建了一套包括接口管理，驱动文件管理，测试参数管理，测试用例管理，测试套件管理，测试批次管理，测试报告管理，认证和权限管理等一系列模块，并能根据设置同步或异步运行测试用例、测试套件、测试批次，生成测试报告，记录测试结果，并可以进行使用jenkins持续集成测试发送测试报告。
目前只包括接口测试，后续将加入UI测试用例的管理。

## 特点：
1. 实现模块化，不需要进行大量的开发工作，只需结合各个模块进行逻辑开发或二次开发，具有易开发、易扩展、易维护等特点。
2. 对接口、用例中的请求数据、校验数据、测试结果等在数据库进行操作，可多次使用，便于测试数据的维护和操作。
3. 根据需求可选择线上与离线两种模式运行测试用例，线上运行用例提供同步和异步模式。

## 主要功能
![主要功能](https://gitee.com/zhujun6538/datest/raw/master/images/%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20(12).png) 
本测试平台分为后台，中台，前台三个部分，后台由django框架管理测试类数据以及保存测试结果数据，中台根据后台数据生成的测试文件，运行测试用例、测试套件、测试批次，前台功能包括直接请求查看实时响应，并可根据响应自动生成断言，实时编辑测试驱动函数等。

## 主要模块
![主要模块](https://gitee.com/zhujun6538/datest/raw/master/images/%E6%A1%86%E6%9E%B6%20(6).png) 

## 操作说明
### 一. 接口管理
![接口管理](https://gitee.com/zhujun6538/datest/raw/master/images/api.png) 
接口管理可以对接口数据进行增删改查，支持分组，添加请求头，导出等操作。
   
### 二. 测试用例管理
![测试用例管理](https://gitee.com/zhujun6538/datest/raw/master/images/testacse.png) 
测试用例管理可以对测试用例数据进行增删改查，编辑时可进行参数化设置，可调用之前用例的请求及相应参数。编辑成功的测试用例可直接根据测试用例的数据发送请求，生成断言，运行测试后可直接查看测试报告。

#### 1.参数
##### 环境地址
可选择或新增环境，支持http及https请求。

##### 测试接口
可搜索选择状态为有效的接口。

##### 是否有效
状态为有效的测试用例数据能在测试套件中选择。

##### 请求参数类型-请求报文
如果请求参数类型选择JSON，发送请求为请求报文文本框内输入的json格式的文本，前端没有判断，格式必须正确，否则报错。
如果请求参数类型选择FORM-DATA，发送请求为请求报文文本框内输入的请求参数，格式为
参数：值
参数：值
参数：值
每一个空一行

##### 自定义函数
可在驱动文件中修改项目的测试驱动文件中编写自定义函数，在请求报文输入框，FORMDATA参数输入框，自定义请求头输入框可使用自定义函数，可使用${方法名(参数)}获得变量

##### 请求前置方法
可在驱动文件中修改项目的测试驱动文件中编写自定义前置方法，可选参数为request，request为requests.request对象，可以新建前置方法${方法名($request)}对request对象操作。

##### 请求后置方法
可在驱动文件中修改项目的测试驱动文件中编写自定义前置方法，可选参数为response，request为requests.request返回的response对象，可以新建后置方法${方法名($response)}对response对象操作。

##### 自定义运行方法
运行方法可在脚本中自定义配置，文件为apitest/runner/callfunc.py，原始方法为default_func，如不设置默认使用原始方法，可在脚本内加入自定义方法对测试用例中设置的值进行自定义操作，有较高的灵活性，但需要一定编程基础。

##### 自定义请求头输入框
加入额外的请求头，如存在与API请求头重复则覆盖API中的请求头。

##### 请求参数
GET方法中的参数

##### FORMDATA参数
如果请求参数类型选择FORM-DATA，而且请求报文文本框内未输入内容为{}，可手动加入FORM-DATA并保存入库。如请求报文文本框有内容，此处输入内容无效。

##### 复用历史参数
当请求和响应格式为JSON时，在请求报文输入框，FORMDATA参数输入框，自定义请求头输入框请求参数的值可以设置为之前用例中的请求和响应中存在的值，格式为”&$.用例编号.requestdata(或responsedata)..参数&”，"$.用例编号.requestdata(或responsedata)..参数"，可以看出是JSONPATH的路径，用例编号必须为已经运行用例，否则将报错，需要自己根据先后关系排列用例，此功能必须使用测试套件对用例进行排序运行。

##### 校验参数
![校验参数](https://gitee.com/zhujun6538/datest/raw/master/images/assert.png) 
当响应格式为JSON时,校验参数取值使用jmespath取值，并根据设置的模式进行断言，支持12种断言模式，校验参数不可使用复用历史参数。

#### 1.操作
##### 导入
可批量导入测试用例，导入后默认为有效，请求报文目前只支持导入JSON数据，请参考用例导入模板。

##### 复制
可对测试用例进行复制，生成新的用例编号。

##### 生成文件
在apitest/runner/data下生成yaml格式的测试用例文件，可以直接运行apitest/runner下的testrunner脚本运行此yaml文件，实现离线操作。

##### 运行选中用例
异步逐个运行勾选的所有测试用例，并为每个用例生成测试报告及测试报告模块下测试结果数据。

##### 查看报告
运行完成后可查看此用例最后一次运行生成的测试结果和测试报告，测试报告详细记录了本次测试的请求、响应、断言、日志等数据。

##### 发送请求&自动生成校验
![发送请求&自动生成校验](https://gitee.com/zhujun6538/datest/raw/master/images/%E7%BD%91%E9%A1%B5%E6%8D%95%E8%8E%B7_24-3-2021_11412_127.0.0.1.jpeg) 
点击后根据测试数据发送请求取得响应，页面可根据响应自动生成校验参数，目前支持一级参数。

### 三. 驱动文件管理
可实时编辑请求前方法和响应后方法

#### 1.操作
##### 编辑
![编辑](https://gitee.com/zhujun6538/datest/raw/master/images/Image%207.png) 
保存后可在测试用例内添加请求前置方法和请求后置方法，运行时将调用。

### 四. 测试套件管理
![测试套件管理](https://gitee.com/zhujun6538/datest/raw/master/images/suite.png) 
测试套件管理可以对批量加入测试用例并运行生成测试报告，也可构建指定顺序的测试用例集，可进行多种pytest设置来运行套件，套件中的设置将覆盖用例中的设置。

#### 1.参数
##### 是否顺序执行
勾选是否顺序执行，可在顺序运行用例中依次添加用例，运行时根据输入的顺序号运行用例指定的顺序运行用例。否则按照在用例集中添加的测试用例进行运行，顺序根据用例id排序。

#### 2.操作
##### 生成文件
在apitest/runner/data下生成yaml格式的测试用例文件，可以直接运行apitest/runner下的testrunner脚本运行此yaml文件。

##### 运行选中套件
逐个运行勾选的所有测试套件，并为每个套件生成测试报告及测试报告模块下测试结果数据。

##### 查看报告
运行完成后可查看此用例最后一次运行生成的测试结果和测试报告，测试报告详细记录了本次测试的请求、响应、断言、日志等数据。

##### 查看用例
跳转测试用例列表，结果为所有该套件下的用例。

### 五. 测试批次管理
![测试批次管理](https://gitee.com/zhujun6538/datest/raw/master/images/batch.png) 
测试批次管理可以对批量加入测试套件并运行

#### 1.操作
##### 生成文件
在apitest/runner/data下生成yaml格式的测试用例文件，可以直接运行apitest/runner下的testrunner脚本运行此yaml文件。

##### 运行选中套件
运行批次中所有的测试套件，并根据所有套件中的用例运行情况生成测试报告及测试报告模块下测试结果数据。

##### JENKINS运行选中套件
选择批次调用jenkins指定项目进行构建，构建完成后可在Jenkins运行结果模块查看构建结果。

##### 查看报告
运行完成后可查看此用例最后一次运行生成的测试结果和测试报告，测试报告详细记录了本次测试的请求、响应、断言、日志等数据。

### 六. 测试报告管理
![测试报告管理](https://gitee.com/zhujun6538/datest/raw/master/images/report.png) 
可查看运行测试用例、套件、批次后生成的测试结果信息，点击查看报告可查看测试报告。删除测试报告数据将同时删除文件中的测试报告文件。

#### 1.操作
##### 查看报告
跳转本次测试的本地测试报告网页，测试报告详细记录了本次测试的请求、响应、断言、日志等数据，并根据用例分组分组。

##### 详情
![详情](https://gitee.com/zhujun6538/datest/raw/master/images/reportd.png) 
显示运行测试用例，套件，批次的测试结果详情。

##### 查看失败用例
跳转测试用例列表，结果为所有本次测试结果为失败的用例。

### 七. Jenkins运行结果
![Jenkins运行结果](https://gitee.com/zhujun6538/datest/raw/master/images/jreport.png) 
JENKINS运行选中套件后的运行结果和输出信息列表。

#### 1.操作
##### 详情
![详情](https://gitee.com/zhujun6538/datest/raw/master/images/jreportd.png) 
查看构建结果和构建详情。

### 八. 用户管理
本框架使用了django的用户管理模块，可新增用户并对用户的权限，状态等进行管理，无需自己编写用户模块。